## Section 2.2 TCP/IP 4계층 모델

- 인터넷 프로토콜 스위트(internet protocol suite): 인터넷에서 컴퓨터들이 서로 정보를 주고 받는 데 쓰이는 프로토콜의 집합
    - TPC/IP 4계층 모델: 네트워크에서 사용되는 통신 프로토콜의 집합. 네트워킹 범위에 따라 4개의 추상화 계층으로 구성
    - OSI 7계층 모델
        - 애플리케이션 계층 - 애플리케이션, 프레젠테에션, 세션
        - 링크 계층 - 데이터 링크, 물리
        - 인터넷 계층 - 네트워크

### 2.2.1 계층구조

- 각 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계됨.

- 애플리케이션(Application) 계층
    - FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용
    - 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공

- 전송(Transport) 계층
    - 송신자와 수신자를 연결하는 통신 서비스를 제공
    - 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
    - 애플리케이션과 인터넷 계층 사이의 데이터 전달 시 중계
    - TCP, UDP
        - TCP(Transmission Control Protocol 전송 제어 프로토콜)
            - 패킷 사이의 `순서 보장`
            - `연결지향` 프로토콜 사용해서 연결
            - 신뢰성 구축. 수신 여부 확인 → 데이터 전달 보증
            - 가상회선 패킷 교환 방식 사용
                
                각 패킷에 `가상회선 식별자` 포함.
                모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 `순서대로` 도착
                
            - TCP 연결 성립 과정 - 3 way handshake
                
                SYN(SYNchronization. 연결 요청 플래그)
                ACK(ACKnowledgement. 응답 플래그)
                
                ISN(Initial Sequence Numbers. 초기 네트워크 연결 시 할당된 32비트 고유 시퀀스 번호)
                
                ACK단계 승인번호: ISN + 1
                
            - TCP 연결 해제 과정 - 4 way handshake
                
                1번: 클라이언트가 FIN으로 설정된 세그먼트 전송. 
                       클라이언트 - FIN_WAIT_1 상태
                
                2번: 서버가 ACK 승인 세그먼트 전송. 
                       서버 - CLOSE_WAIT 상태.
                       클라이언트 - 받으면 FIN_WAIT_2 상태
                
                3번: ACK를 보내고 일정 시간 이후 FIN 세그먼트 전송.
                
                4번: 클라이언트 - TIME_WAIT 상태. 서버로 ACK wjsthd
                       서버 - CLOSED 상태
                       클라이언트는 어느 정도의 시간을 대기 후 연결이 닫히고
                       클라이언트와 서버의 모든 자원의 연결이 해제
                
                ⭐️ TIME_WAIT
                
                - 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태.
                시간은 OS마다 다름. CentOS6, 우분투 - 60초 / 윈도우 - 4분
                - 왜 일정 시간 뒤에?
                → 지연 패킷이 발생할 경우 대비. 데이터 무결성 문제 방지
                    (*데이터 무결성: 데이터의 정확성과 일관성을 유지하고 보증하는 것)
                → 두 장치의 연결 닫힘을 확인하기 위함.
        - UDP
            - 순서 보장 X
            - 수신여부 확인 X, 데이터 전달 보증 X
            - 단순히 데이터만 줌
            - 연결 지향 X
            - 단순하고 빠름
            - IP + PORT + 체크섬
            - 데이터그램 패킷 교환 방식 사용
                
                패킷이 독립적으로 이동하며 최적의 경로를 선택
                
                하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송
                
                `순서가 다를 수` 있다.
                

- 인터넷(Internet) 계층
    - 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
    - IP, ARP, ICMP 등
    - 패킷을 수신해야할 상대의 주소를 지정하여 데이터 전달.
    - 받았는지는 보장하지 않는 **비연결형**

- 링크 계층
    - 전선, 광섬유, 무선 등
    - 실질적으로 데이터 전달
    - 장치 간에 신호를 주고 받는 ‘규칙’을 정함
    - 네트워크 접근 계층
    - 물리 계층 / 데이터 링크 계층
        - 물리 - 무선 LAN, 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
        - 데이터 링크 - `이더넷 프레임`을 통해 에러 확인, 흐름 제어, 접근 제어를 담당
    - 전이중화(full duplex) 통신
        
        - 양쪽 장치가 동시에 송수신할 수 있는 방식
        - 송신로와 수신로로 분리
    - 반이중화(half duplex) 통신
        
        - 양쪽 장치가 통신 가능하지만 동시 통신 불가
        - 한 번에 한 방향만 통신 가능
        - 장치가 신호를 수신하기 시작하면 전송이 완료될 때까지 기다려서 응답
        - 둘 이상의 장치가 동시에 전송하면 충돌 발생. 메시지 손실/왜곡 가능성
        → 충돌 방지 시스템 필요

- 계층 간 데이터 송수신 과정
    
    - 캡슐화 과정
        - 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
        - 애플리케이션 → 전송 ⇒ 데이터가 ‘세그먼트’ 또는 ‘데이터그램’화 되며 TCP(L4) 헤더가 붙음
        - → 인터넷 ⇒ IP(L3) 헤더가 붙으며 ‘패킷’화
        - → 링크 ⇒ 프레임 헤더와 프레임 트레일러가 붙어 ‘프레임’화
    - 비캡슐화
        - 하위 → 상위
        - 각 계층의 헤더 부분을 제거
        - 프레임화 → 패킷화 → 세그먼트, 데이터그램화 → 메시지화
        - 최종적으로 애플리케이션의 PDU인 메시지로 전달

### 2.2.2 PDU(Protocol Data Unit)

- 헤더(제어 관련 정보 포함)와 페이로드(데이터)로 구성
- 애플리케이션: 메시지
전송: 세그먼트(TCP), 데이터그램(UDP)
인터넷: 패킷
링크: 프레임(데이터 링크), 비트(물리)

