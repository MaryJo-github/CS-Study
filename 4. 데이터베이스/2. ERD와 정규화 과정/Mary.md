# ERD와 정규화 과정

ERD(Entity Relationship Diagram)

- 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할
- 릴레이션 간의 관계들을 정의한 것
- **서비스를 구축한다면 가장 먼저 신경써야 할 부분**

# ERD의 중요성

- ERD는 시스템의 요구 사항을 기반으로 작성되며 이 ERD를 기반으로 데이터베이스를 구축
- 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우 설계도 역할을 담당
- 관계형 구조로 표현할 수 있는 데이터를 구성하는데는 유용하나, 비정형 데이터는 충분히 표현할 수 없음
    - 비정형 데이터: 비구조화 데이터. 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보

# 예제로 배우는 ERD

## 영업부서의 ERD

### 요구사항

- 영업사원은 0~n명의 고객을 관리
- 고객은 0~n개의 주문 가능
- 주문에는 1~n개의 상품

### ERD
<img width="311" alt="스크린샷 2024-02-21 오전 11 45 32" src="https://github.com/MaryJo-github/CS-Study/assets/42026766/76e60405-bda3-4873-a487-83dc5cdec79a">

## 게임의 ERD

### 요구사항

- 선수들은 1명의 챔피언을 선택
- 챔피언은 한 개 이상의 스킬을 소유
- 스킬은 한 개 이상의 특성을 가짐

### ERD
<img width="422" alt="스크린샷 2024-02-21 오전 11 47 53" src="https://github.com/MaryJo-github/CS-Study/assets/42026766/c6871ff2-8924-4695-adc7-5845702c2dd9">

# 정규화 과정

- 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나서 이를 해결하거나,
저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정
    - 데이터베이스 이상 현상: 회원이 한 개의 등급을 가져야 하는데 세 개의 등급을 갖거나 삭제할 때 필요한 데이터가 같이 삭제되고, 데이터를 삽입해야 하는데 하나의 필드 값이 NULL이 되면 안되어서 삽입하기 어려운 현상
- 정규형 원칙을 기반으로 정규형을 만들어가는 과정, 정규화된 정도는 정규형(NF, Normal Form)으로 표현
- 정규형의 종류
    - 기본 정규형: 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형
    - 고급 정규형: 제4정규형, 제5정규형

## 정규형 원칙

- 같은 의미를 표현하는 릴레이션이지만
    1. 좀 더 좋은 구조로 만들어야 하고,
    2. 자료의 중복성은 감소해야 하고,
    3. 독립적인 관계는 별개의 릴레이션으로 표현해야 하며,
    4. 각각의 릴레이션은 독립적인 표현이 가능해야 하는 것

## 제1정규형

- 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자 값(atomic value)만으로 구성되어야 함
- 릴레이션의 속성 값 중에서 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안됨

## 제2정규형

- 릴레이션이 제1정규형이며, 부분 함수의 종속성을 제거한 형태
- 부분 함수의 종속성 제거란 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말함
- 릴레이션을 분해할 때에는 동등한 릴레이션으로 분해해야 하고, 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 함

## 제3정규형

- 제2정규형이고, 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)을 만족하지 않는 상태
    - 이행적 함수 종속: A→B와 B→C가 존재하면 논리적으로 A→C가 성립하는데, 이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 함

## 보이스/코드 정규형(BCNF)

- 제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태
    - 결정자: 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소. X→Y일 때 X는 결정자, Y는 종속자

※ 정규화 과정을 거쳐 테이블을 나눈다고 해서 성능이 100% 좋아지는 것은 아님. 테이블을 나누게 되면 어떠한 쿼리는 조인을 해야 하는 경우도 생겨서 오히려 느려질 수도 있음. 서비스에 따라 정규화 또는 비정규화 과정을 진행
